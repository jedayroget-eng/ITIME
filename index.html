<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cedro Aventuras - Gest√£o Completa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #2d5a27; --danger: #e74c3c; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 60px; min-height: 100vh; position: relative; }
        #login-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: var(--primary); position: fixed; width: 100%; z-index: 2000; }
        .login-box { background: white; padding: 30px; border-radius: 15px; width: 300px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        input, select { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .btn-entrar { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #app-screen { display: none; padding: 15px; }
        header { background: white; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .panel { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .grid-veiculos { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-top: 15px; }
        .v-btn { padding: 18px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 14px; }
        .time-controls { display: flex; gap: 8px; align-items: center; margin: 10px 0; }
        .btn-time { background: #ddd; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1; }
        .cards-area { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px; }
        .card { background: white; padding: 20px; border-radius: 10px; border-left: 8px solid var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .card.expired { border-left-color: var(--danger); background: #fff5f5; animation: alert 1s infinite; }
        @keyframes alert { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }
        .btn-card { padding: 10px 5px; border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; flex: 1; font-size: 12px; margin: 2px; }
        .history { margin-top: 30px; background: white; padding: 20px; border-radius: 12px; overflow-x: auto; margin-bottom: 40px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        .badge { padding: 5px 10px; border-radius: 20px; font-size: 11px; font-weight: bold; cursor: pointer; }
        .pago { background: #d4edda; color: #155724; }
        .pendente { background: #f8d7da; color: #721c24; }
        #btn-apagar-geral { background: var(--danger); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; display: none; font-weight: bold; }
        
        .btn-consolidado { background: #3498db; color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; margin-bottom: 15px; display: inline-flex; align-items: center; gap: 8px; }

        #modal-alerta {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 400px; background: #c0392b; color: white; padding: 30px;
            border-radius: 20px; text-align: center; z-index: 5000; box-shadow: 0 0 100px rgba(0,0,0,0.5);
            animation: pulsar-bg 0.8s infinite alternate;
        }
        @keyframes pulsar-bg {
            from { background: #c0392b; transform: translate(-50%, -50%) scale(1); }
            to { background: #ff0000; transform: translate(-50%, -50%) scale(1.05); }
        }
        .overlay-alerta { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); z-index: 4999; }
        .btn-fechar-alerta { background: white; color: red; padding: 15px 30px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin-top: 20px; font-size: 18px; }
        
        #alerta-financeiro-btn {
            background: rgba(255,255,255,0.2); color: white; border: 2px solid white;
            padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer;
            margin: 15px 0; display: block; width: 100%; font-size: 16px;
        }

        .footer-creditos {
            text-align: center;
            font-size: 12px;
            padding: 20px 0;
            width: 100%;
            color: #777;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
        }
        #login-screen .footer-creditos { color: rgba(255,255,255,0.7); position: absolute; bottom: 20px; }
        .wa-icon { width: 14px; height: 14px; vertical-align: middle; }
    </style>
</head>
<body>

<div id="overlay-alerta" class="overlay-alerta"></div>
<div id="modal-alerta">
    <h1 style="margin:0; font-size: 50px;">üîî</h1>
    <h2 id="alerta-titulo">TEMPO ACABOU!</h2>
    <p id="alerta-veiculo" style="font-size: 24px; font-weight: bold; margin: 10px 0;"></p>
    <button id="alerta-financeiro-btn" onclick="window.alternarPagamentoModal()">---</button>
    <button class="btn-fechar-alerta" onclick="window.fecharAlerta()">ESTOU CIENTE</button>
</div>

<div id="login-screen">
    <div class="login-box">
        <h2 style="color: var(--primary)">üå≤ Cedro Gest√£o</h2>
        <button class="btn-entrar" style="background: #28a745; margin-bottom: 10px;" onclick="window.ativarNotificacoes()">1¬∫ ATIVAR ALERTAS</button>
        <input type="text" id="user" placeholder="Usu√°rio">
        <input type="password" id="pass" placeholder="Senha">
        <button class="btn-entrar" onclick="window.tentarLogin()">ENTRAR</button>
    </div>
    <div class="footer-creditos">
        App desenvolvido por Jeday Roget <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" class="wa-icon"> (88) 981385466 Copyright¬© Todos os direitos Reservados.
    </div>
</div>

<div id="app-screen">
    <header>
        <div id="op-nome" style="font-weight: bold;">Op: ---</div>
        <div id="relogio" style="font-family: monospace; font-size: 18px;">00:00:00</div>
        <button onclick="location.reload()">SAIR</button>
    </header>

    <div class="panel">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <input type="text" id="nome-crianca" placeholder="Nome da Crian√ßa">
            <input type="text" id="nome-responsavel" placeholder="Nome do Respons√°vel">
        </div>
        <div class="time-controls">
            <button class="btn-time" onclick="window.setQuickTime(5)">5m</button>
            <button class="btn-time" onclick="window.setQuickTime(10)">10m</button>
            <button class="btn-time" onclick="window.setQuickTime(15)">15m</button>
            <button class="btn-time" style="background: #34495e; color: white;" onclick="window.setQuickTime(9999)">‚àû Livre</button>
            <input type="number" id="tempo-padrao" value="10" style="width: 70px; text-align: center;">
            <select id="pg-status" style="width: 130px;">
                <option value="N√£o">PENDENTE</option>
                <option value="Sim">PAGO</option>
            </select>
        </div>
        <div class="grid-veiculos">
            <button class="v-btn" style="background:#95a5a6" onclick="window.iniciar('Carrinho Branco')">üöó Carrinho Branco</button>
            <button class="v-btn" style="background:#c0392b" onclick="window.iniciar('Carrinho Vermelho')">üöó Carrinho Vermelho</button>
            <button class="v-btn" style="background:#f1c40f; color:black" onclick="window.iniciar('Triciclo Amarelo')">üö≤ Triciclo Amarelo</button>
            <button class="v-btn" style="background:#e082ac" onclick="window.iniciar('Triciclo Rosa')">üö≤ Tririclo Rosa</button>
            <button class="v-btn" style="background:#ffffff; color: black; border: 1px solid #ccc;" onclick="window.iniciar('Triciclo Branco')">üö≤ Triciclo Branco</button>
            <button class="v-btn" style="background:#34495e" onclick="window.iniciar('Patinete')">üõ¥ Patinete</button>
        </div>

    <div class="cards-area" id="container-cards"></div>

    <div class="history">
        <button class="btn-consolidado" onclick="window.open('https://jedayroget-eng.github.io/teste/', '_blank')">
            üìÇ RELAT√ìRIO CONSOLIDADO DI√ÅRIO
        </button>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3>üìä Relat√≥rio e Soma</h3>
            <button id="btn-apagar-geral" onclick="window.limparHistoricoGeral()">APAGAR RELAT√ìRIO</button>
        </div>
        <table id="tabela-hist">
            <thead>
                <tr>
                    <th>Brinquedo</th>
                    <th>Crian√ßa/Respons√°vel</th>
                    <th>In√≠cio/Fim</th>
                    <th>Tempo</th>
                    <th>Valor</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
                <tr style="background:#eee; font-weight:bold;">
                    <td colspan="4">TOTAL ACUMULADO</td>
                    <td id="total-valor" colspan="2">R$ 0,00</td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="footer-creditos">
        App desenvolvido por Jeday Roget <img src="https://cdn-icons-png.flaticon.com/512/733/733585.png" class="wa-icon"> (88) 981385466 Copyright¬© Todos os direitos Reservados.
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, query, orderBy, getDocs, writeBatch } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD3WIeOM21IkcjytZ9-We7vJjOV-dYq2IA",
        authDomain: "cedro-aventuras.firebaseapp.com",
        projectId: "cedro-aventuras",
        storageBucket: "cedro-aventuras.firebasestorage.app",
        messagingSenderId: "750741113990",
        appId: "1:750741113990:web:35783abcde7f8eb6f6d507"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let usuarioAtivo = "";
    const contas = { "Jeday": "", "Cydinha": "1234", "Thallys": "1234" };
    const timersLocais = {};
    let notificacaoPermitida = false;
    let filaAlertas = [];

    window.ativarNotificacoes = () => {
        Notification.requestPermission().then(perm => {
            if (perm === "granted") {
                notificacaoPermitida = true;
                alert("Notifica√ß√µes e Sons Ativados!");
            }
        });
    };

    window.tentarLogin = () => {
        const u = document.getElementById('user').value;
        const p = document.getElementById('pass').value;
        if (contas[u] === p) {
            usuarioAtivo = u;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'block';
            document.getElementById('op-nome').innerText = "Op: " + u;
            if(u.toUpperCase() === "JEDAY") document.getElementById('btn-apagar-geral').style.display = 'block';
        } else { alert("Senha incorreta!"); }
    };

    window.setQuickTime = (v) => document.getElementById('tempo-padrao').value = v;

    window.iniciar = async (veiculo) => {
        const inputTempo = document.getElementById('tempo-padrao').value;
        const mins = parseInt(inputTempo) || 10;
        const ehLivre = mins >= 9999;
        
        const crianca = document.getElementById('nome-crianca').value || "Cliente";
        const responsavel = document.getElementById('nome-responsavel').value || "N√£o informado";
        const agora = Date.now();
        const fimTimestamp = agora + (mins * 60 * 1000);
        const previsaoTexto = ehLivre ? "Uso Livre" : new Date(fimTimestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});

        await addDoc(collection(db, "ativos"), {
            veiculo, crianca, responsavel,
            fimTimestamp: fimTimestamp,
            totalMinsContratados: mins,
            inicio: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
            previsaoFim: previsaoTexto,
            pago: document.getElementById('pg-status').value,
            pausado: false, 
            notificado: false,
            timestamp: agora,
            modalidadeLivre: ehLivre
        });
        document.getElementById('nome-crianca').value = "";
        document.getElementById('nome-responsavel').value = "";
        document.getElementById('tempo-padrao').value = "10";
    };

    window.alternarPagamentoCard = async (id, statusAtual) => {
        const novoStatus = statusAtual === 'Sim' ? 'N√£o' : 'Sim';
        await updateDoc(doc(db, "ativos", id), { pago: novoStatus });
    };

    onSnapshot(collection(db, "ativos"), (snap) => {
        const container = document.getElementById('container-cards');
        const idsNoBanco = snap.docs.map(d => d.id);

        Object.keys(timersLocais).forEach(id => {
            if (!idsNoBanco.includes(id)) {
                clearInterval(timersLocais[id].interval);
                delete timersLocais[id];
                const el = document.getElementById(`card-${id}`);
                if (el) el.remove();
                filaAlertas = filaAlertas.filter(a => a.id !== id);
            }
        });

        snap.docs.forEach(docSnap => {
            const data = docSnap.data();
            const id = docSnap.id;

            if (!timersLocais[id]) {
                const cardHtml = `
                    <div class="card" id="card-${id}">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <b>${data.veiculo}</b>
                            <span id="badge-card-${id}" class="badge ${data.pago === 'Sim' ? 'pago' : 'pendente'}" style="cursor:pointer; font-size:10px;" onclick="window.alternarPagamentoCard('${id}', '${data.pago}')">
                                ${data.pago === 'Sim' ? 'PAGO' : 'PENDENTE'}
                            </span>
                        </div>
                        <div style="font-size:38px; font-weight:bold; margin:5px 0;" id="timer-${id}">--:--</div>
                        <div style="font-size:13px; line-height:1.4">
                            <b>Crian√ßa:</b> ${data.crianca}<br>
                            <b>Resp:</b> ${data.responsavel}<br>
                            <span style="color:#666">In√≠cio: ${data.inicio} | Fim: ${data.previsaoFim}</span>
                        </div>
                        <div style="display:flex; margin-top:10px;">
                            <button class="btn-card" style="background:green" onclick="window.ajustar('${id}', 60)">+1m</button>
                            <button class="btn-card" style="background:orange" onclick="window.ajustar('${id}', -60)">-1m</button>
                            <button class="btn-card" style="background:blue" id="btn-p-${id}" onclick="window.togglePausa('${id}')">${data.pausado ? '‚ñ∂' : '‚è∏'}</button>
                            <button class="btn-card" style="background:#444" onclick="window.imprimir('${id}')">üñ®Ô∏è</button>
                            <button class="btn-card" style="background:red" onclick="window.finalizar('${id}')">FIM</button>
                        </div>
                    </div>`;
                container.insertAdjacentHTML('beforeend', cardHtml);
                
                timersLocais[id] = {
                    notificado: data.notificado,
                    interval: setInterval(() => {
                        const snapAtual = snap.docs.find(d => d.id === id);
                        if(!snapAtual) return;
                        const d = snapAtual.data();
                        
                        if (!d.pausado) {
                            const agora = Date.now();
                            const el = document.getElementById(`timer-${id}`);

                            if (d.modalidadeLivre) {
                                const decorrido = Math.floor((agora - d.timestamp) / 1000);
                                const m = Math.floor(decorrido / 60);
                                const s = (decorrido % 60).toString().padStart(2, '0');
                                if(el) el.innerText = `‚àû ${m}:${s}`;
                            } else {
                                const segundosRestantes = Math.max(0, Math.floor((d.fimTimestamp - agora) / 1000));
                                if(el) {
                                    const m = Math.floor(segundosRestantes / 60);
                                    const s = (segundosRestantes % 60).toString().padStart(2, '0');
                                    el.innerText = `${m}:${s}`;
                                }
                                if (segundosRestantes <= 0) {
                                    document.getElementById(`card-${id}`).classList.add('expired');
                                    if(!timersLocais[id].notificado) {
                                        dispararAlertaGlobal(id, d.veiculo, d.pago);
                                        timersLocais[id].notificado = true;
                                    }
                                }
                            }
                        }
                    }, 1000)
                };
            } else {
                const b = document.getElementById(`btn-p-${id}`);
                if(b) b.innerText = data.pausado ? "‚ñ∂" : "‚è∏";
                
                const badgeCard = document.getElementById(`badge-card-${id}`);
                if (badgeCard) {
                    badgeCard.innerText = data.pago === 'Sim' ? 'PAGO' : 'PENDENTE';
                    badgeCard.className = `badge ${data.pago === 'Sim' ? 'pago' : 'pendente'}`;
                    badgeCard.setAttribute('onclick', `window.alternarPagamentoCard('${id}', '${data.pago}')`);
                }

                filaAlertas.forEach(a => { if(a.id === id) a.pago = data.pago; });
                if(filaAlertas.length > 0 && filaAlertas[0].id === id) {
                    atualizarVisualBotaoModal(data.pago);
                }
            }
        });
    });

    function dispararAlertaGlobal(id, veiculo, pago) {
        filaAlertas.push({ id, veiculo, pago });
        if (document.getElementById('modal-alerta').style.display !== 'block') {
            processarProximoAlerta();
        }
        if (notificacaoPermitida) new Notification("TEMPO ACABOU: " + veiculo);
        new Audio('https://actions.google.com/sounds/v1/alarms/alarm_clock_ringing_beep.ogg').play();
    }

    function processarProximoAlerta() {
        if (filaAlertas.length > 0) {
            const alerta = filaAlertas[0];
            document.getElementById('alerta-veiculo').innerText = alerta.veiculo;
            atualizarVisualBotaoModal(alerta.pago);
            document.getElementById('modal-alerta').style.display = 'block';
            document.getElementById('overlay-alerta').style.display = 'block';
        } else {
            document.getElementById('modal-alerta').style.display = 'none';
            document.getElementById('overlay-alerta').style.display = 'none';
        }
    }

    function atualizarVisualBotaoModal(pago) {
        const btn = document.getElementById('alerta-financeiro-btn');
        btn.innerText = pago === 'Sim' ? "‚úÖ EST√Å PAGO (Clique p/ Mudar)" : "‚ö†Ô∏è RECEBER PAGAMENTO (Clique p/ Mudar)";
    }

    window.alternarPagamentoModal = async () => {
        if (filaAlertas.length === 0) return;
        const atual = filaAlertas[0];
        const novoStatus = atual.pago === 'Sim' ? 'N√£o' : 'Sim';
        await updateDoc(doc(db, "ativos", atual.id), { pago: novoStatus });
        atual.pago = novoStatus;
        atualizarVisualBotaoModal(novoStatus);
    };

    window.fecharAlerta = () => {
        filaAlertas.shift(); 
        document.getElementById('modal-alerta').style.display = 'none';
        if (filaAlertas.length > 0) {
            setTimeout(processarProximoAlerta, 300);
        } else {
            document.getElementById('overlay-alerta').style.display = 'none';
        }
    };

    window.imprimir = async (id) => {
        const s = await getDocs(collection(db, "ativos"));
        const docAtivo = s.docs.find(x => x.id === id);
        if(!docAtivo) return;
        const d = docAtivo.data();
        const statusPagamento = d.pago === 'Sim' ? 'PAGO' : 'PENDENTE';
        const w = window.open('', '', 'width=300,height=400');
        w.document.write(`<html><body onload="window.print();window.close()"><div style="font-family:monospace;width:58mm;font-size:12px;">
            <center>üå≤ CEDRO AVENTURAS üå≤</center><br>
            ----------------------------<br>
            <b>VE√çCULO: ${d.veiculo}</b><br>
            ----------------------------<br>
            <b>CRIAN√áA:</b> ${d.crianca.toUpperCase()}<br>
            <b>RESP.:</b> ${d.responsavel.toUpperCase()}<br><br>
            <b>IN√çCIO:</b> ${d.inicio}<br>
            <b>FIM ESTIMADO:</b> ${d.previsaoFim}<br><br>
            <div style="border:1px solid black; padding:5px; text-align:center;">
                <b style="font-size:16px;">STATUS: ${statusPagamento}</b>
            </div><br>
            ----------------------------<br>
            Operador: ${usuarioAtivo}<br>
            Data: ${new Date().toLocaleDateString()}<br>
            <center>Obrigado pela prefer√™ncia!</center>
        </div></body></html>`);
        w.document.close();
    };

    window.togglePausa = async (id) => {
        const s = await getDocs(collection(db, "ativos"));
        const d = s.docs.find(x => x.id === id).data();
        const agora = Date.now();
        
        if (!d.pausado) {
            const restava = d.fimTimestamp - agora;
            await updateDoc(doc(db, "ativos", id), { pausado: true, milisegundosRestantesNaPausa: restava });
        } else {
            const novoFim = agora + d.milisegundosRestantesNaPausa;
            await updateDoc(doc(db, "ativos", id), { 
                pausado: false, 
                fimTimestamp: novoFim,
                previsaoFim: d.modalidadeLivre ? "Uso Livre" : new Date(novoFim).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})
            });
        }
    };

    window.ajustar = async (id, seg) => {
        const s = await getDocs(collection(db, "ativos"));
        const d = s.docs.find(x => x.id === id).data();
        const novoFim = d.fimTimestamp + (seg * 1000);
        
        if(novoFim > Date.now()) {
            timersLocais[id].notificado = false;
            document.getElementById(`card-${id}`).classList.remove('expired');
            filaAlertas = filaAlertas.filter(a => a.id !== id);
        }
        
        await updateDoc(doc(db, "ativos", id), { 
            fimTimestamp: novoFim,
            previsaoFim: d.modalidadeLivre ? "Uso Livre" : new Date(novoFim).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
            notificado: false
        });
    };

    window.finalizar = async (id) => {
        const s = await getDocs(collection(db, "ativos"));
        const docAtivo = s.docs.find(x => x.id === id);
        if(!docAtivo) return;
        const d = docAtivo.data();
        const agora = Date.now();
        
        const decorridoMs = agora - d.timestamp;
        const usadoMins = Math.floor(decorridoMs / 60000);
        const tempoFinal = Math.max(1, usadoMins);

        await addDoc(collection(db, "historico"), {
            veiculo: d.veiculo, crianca: d.crianca, responsavel: d.responsavel,
            tempo: tempoFinal, inicio: d.inicio, 
            fimReal: new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
            pago: d.pago, operador: usuarioAtivo, data: Date.now()
        });
        await deleteDoc(doc(db, "ativos", id));
    };

    onSnapshot(query(collection(db, "historico"), orderBy("data", "desc")), (snap) => {
        const tbody = document.querySelector("#tabela-hist tbody");
        tbody.innerHTML = "";
        let total = 0;
        snap.forEach(docSnap => {
            const h = docSnap.data();
            total += h.tempo;
            tbody.innerHTML += `<tr>
                <td>${h.veiculo}</td>
                <td>${h.crianca}<br><small>Resp: ${h.responsavel}</small></td>
                <td>${h.inicio} √†s ${h.fimReal}</td>
                <td>${h.tempo}m</td>
                <td>R$ ${h.tempo},00</td>
                <td><span class="badge ${h.pago === 'Sim' ? 'pago' : 'pendente'}" onclick="window.altStatus('${docSnap.id}','${h.pago}')">${h.pago === 'Sim' ? 'PAGO' : 'PENDENTE'}</span></td>
            </tr>`;
        });
        document.getElementById('total-valor').innerText = `R$ ${total},00`;
    });

    window.altStatus = async (id, s) => await updateDoc(doc(db, "historico", id), { pago: s === 'Sim' ? 'N√£o' : 'Sim' });

    window.limparHistoricoGeral = async () => {
        if(confirm("Deseja apagar o relat√≥rio completo do dia?")) {
            const s = await getDocs(collection(db, "historico"));
            const b = writeBatch(db);
            s.forEach(d => b.delete(d.ref));
            await b.commit();
        }
    };

    setInterval(() => { document.getElementById('relogio').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>
</body>
</html>