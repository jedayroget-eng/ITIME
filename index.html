<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cedro Aventuras - V11.6</title>
    <style>
        :root { --primary: #2d5a27; --danger: #e74c3c; --bg: #f0f2f5; --insta: #8e44ad; --pago: #27ae60; --pendente: #c0392b; --zap: #25d366; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding-bottom: 60px; }
        
        #ticket-area { background: #333; color: white; padding: 12px; border-radius: 0 0 15px 15px; margin-bottom: 15px; text-align: center; }
        .btn-imprimir-ticket { background: #fff; color: #333; border: none; padding: 8px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 90%; font-size: 14px; margin-top: 5px; }
        
        #print-section { display: none; }
        @media print {
            body * { visibility: hidden; }
            #print-section, #print-section * { visibility: visible; }
            #print-section { display: block; position: absolute; left: 0; top: 0; width: 100%; font-family: monospace; }
        }

        #login-screen { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: var(--primary); position: fixed; width: 100%; z-index: 2000; }
        .login-box { background: white; padding: 30px; border-radius: 15px; width: 300px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 5px 0; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .btn-entrar { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        #app-screen { display: none; padding: 15px; }
        header { background: white; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .panel { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .grid-veiculos { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; }
        .v-btn { padding: 15px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }
        .time-controls { display: flex; gap: 5px; margin: 10px 0; align-items: center; }
        .btn-time { background: #ddd; border: none; padding: 10px; border-radius: 8px; cursor: pointer; flex: 1; font-weight: bold; }
        
        .cards-area { display: flex; flex-wrap: wrap; gap: 15px; }
        .card { background: white; padding: 15px; border-radius: 10px; border-left: 8px solid var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: relative; transition: 0.3s; width: 310px; order: 1; }
        .card.paused { border-left-color: #f1c40f; background: #fffdf5; }
        
        .card.expired { 
            border: 4px solid var(--danger); 
            animation: pulse-red 1.5s infinite; 
            background: #fff5f5;
            order: -1 !important;
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0px rgba(231, 76, 60, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(231, 76, 60, 0); }
            100% { box-shadow: 0 0 0 0px rgba(231, 76, 60, 0); }
        }

        .insta-badge-card { background: var(--insta); color: white; font-size: 10px; padding: 2px 8px; border-radius: 4px; position: absolute; top: 10px; right: 10px; font-weight: bold; }
        .btn-status-card { width: 100%; padding: 10px; margin: 10px 0 5px 0; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 13px; }
        .status-pago { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status-pendente { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .btn-card { padding: 10px 5px; border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; flex: 1; margin: 2px; font-size: 11px; }
        .badge { padding: 4px 8px; border-radius: 20px; font-size: 10px; font-weight: bold; cursor: pointer; border: none; }
        .pago { background: #27ae60; color: white; }
        .pendente { background: #c0392b; color: white; }

        .history { margin-top: 30px; background: white; padding: 15px; border-radius: 12px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; margin-bottom: 20px; }
        th, td { padding: 10px 5px; text-align: left; border-bottom: 1px solid #eee; }
        .header-dia { background: #eee; font-weight: bold; text-align: center; color: #333; }
        .total-row { background: #f8f9fa; font-weight: bold; }
        .divider { height: 2px; background: #ddd; margin: 30px 0; }
        .btn-whatsapp { background: var(--zap); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="print-section"></div>

<div id="login-screen">
    <div class="login-box">
        <h2 style="color: var(--primary)">üå≤ Cedro Gest√£o</h2>
        <input type="text" id="user" placeholder="Usu√°rio">
        <input type="password" id="pass" placeholder="Senha">
        <button class="btn-entrar" onclick="window.tentarLogin()">ENTRAR</button>
    </div>
</div>

<div id="app-screen">
    <div id="ticket-area">
        <button class="btn-imprimir-ticket" onclick="window.gerarTicket()">üé´ GERAR TICKET AGORA</button>
        <button onclick="window.limparCardsGeral()" style="background:none; border:none; color:#999; font-size:10px; cursor:pointer; margin-top:5px;">‚ö†Ô∏è Limpar Cards Travados</button>
    </div>

    <header>
        <div id="op-nome" style="font-weight: bold;">Op: ---</div>
        <div id="relogio" style="font-size: 18px; font-family: monospace;">00:00:00</div>
        <button onclick="location.reload()">SAIR</button>
    </header>

    <div class="panel">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
            <input type="text" id="nome-crianca" placeholder="Crian√ßa">
            <input type="text" id="nome-responsavel" placeholder="Respons√°vel">
        </div>
        
        <div class="time-controls">
            <button class="btn-time" onclick="window.setQuickTime(5)">5m</button>
            <button class="btn-time" onclick="window.setQuickTime(10)">10m</button>
            <button class="btn-time" onclick="window.setQuickTime(15)">15m</button>
            <button class="btn-time" onclick="window.setQuickTime(20)">20m</button>
            <button class="btn-time" style="background:#34495e; color:white" onclick="window.setQuickTime(9999)">‚àû Livre</button>
            <input type="number" id="tempo-padrao" value="10" style="width: 60px; text-align: center; border-radius:8px; border:1px solid #ccc; padding: 8px;">
        </div>

        <button id="bonus-toggle" style="background: #eee; border: 2px solid var(--insta); color: var(--insta); padding: 10px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 5px;" onclick="window.toggleInstaPre()">üì∏ APLICAR B√îNUS INSTAGRAM (+20%)</button>
        
        <div class="grid-veiculos" style="margin-top: 15px;">
            <button class="v-btn" style="background:#95a5a6" onclick="window.iniciar('Carrinho Branco')">üöó Carrinho B.</button>
            <button class="v-btn" style="background:#c0392b" onclick="window.iniciar('Carrinho Vermelho')">üöó Carrinho V.</button>
            <button class="v-btn" style="background:#f1c40f; color:black" onclick="window.iniciar('Triciclo Amarelo')">üö≤ Tric. Amarelo</button>
            <button class="v-btn" style="background:#ecf0f1; color:black; border: 1px solid #ccc;" onclick="window.iniciar('Triciclo Branco')">üö≤ Tric. Branco</button>
            <button class="v-btn" style="background:#e082ac" onclick="window.iniciar('Triciclo Rosa')">üö≤ Tric. Rosa</button>
            <button class="v-btn" style="background:#34495e" onclick="window.iniciar('Patinete')">üõ¥ Patinete</button>
        </div>
    </div>

    <div class="cards-area" id="container-cards"></div>

    <div class="history">
        <h3>üìä 1. Resumo por Brinquedo (WhatsApp)</h3>
        <button class="btn-whatsapp" onclick="window.exportarZap()">üöÄ ENVIAR RESUMO (ZAP)</button>
        <table id="tabela-agrupada">
            <thead>
                <tr><th>Brinquedo</th><th>Tempo Total</th><th>Valor Total</th></tr>
            </thead>
            <tbody></tbody>
        </table>

        <div class="divider"></div>

        <h3>üìù 2. Relat√≥rio Detalhado (Hist√≥rico)</h3>
        
        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
            <select id="filtro-brinquedo" onchange="window.renderizarTabelas()" style="flex: 1; padding: 10px; border-radius: 8px;">
                <option value="Todos">Filtrar: TODOS OS BRINQUEDOS</option>
                <option value="Carrinho Branco">Carrinho Branco</option>
                <option value="Carrinho Vermelho">Carrinho Vermelho</option>
                <option value="Triciclo Amarelo">Triciclo Amarelo</option>
                <option value="Triciclo Branco">Triciclo Branco</option>
                <option value="Triciclo Rosa">Triciclo Rosa</option>
                <option value="Patinete">Patinete</option>
            </select>
            <input type="date" id="filtro-data" onchange="window.renderizarTabelas()" style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #ccc;">
        </div>

        <table id="tabela-detalhada">
            <thead>
                <tr><th>Brinquedo</th><th>Crian√ßa</th><th>Hor√°rios</th><th>Uso</th><th>R$</th><th>Status</th></tr>
            </thead>
            <tbody></tbody>
            <tfoot>
                <tr class="total-row"><td colspan="4" style="text-align:right">Total do Filtro:</td><td id="valor-total-detalhado" colspan="2">R$ 0,00</td></tr>
            </tfoot>
        </table>

        <button onclick="window.limparRelatorio()" style="background:#ff4757; color:white; border:none; padding:12px; border-radius:8px; width:100%; font-weight:bold;">LIMPAR HIST√ìRICO</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, query, orderBy, getDocs, getDoc, writeBatch } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD3WIeOM21IkcjytZ9-We7vJjOV-dYq2IA",
        authDomain: "cedro-aventuras.firebaseapp.com",
        projectId: "cedro-aventuras",
        storageBucket: "cedro-aventuras.firebasestorage.app",
        messagingSenderId: "750741113990",
        appId: "1:750741113990:web:35783abcde7f8eb6f6d507"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let bonusAtivo = false, dadosHistorico = [], alertasAtivos = {};

    window.gerarTicket = () => {
        const nome = document.getElementById('nome-crianca').value || "---";
        const resp = document.getElementById('nome-responsavel').value || "---";
        const tempo = document.getElementById('tempo-padrao').value;
        const op = document.getElementById('op-nome').innerText;
        const agora = new Date().toLocaleString();
        
        const printArea = document.getElementById('print-section');
        printArea.innerHTML = `
            <div style="width: 250px; padding: 10px; border: 1px dashed #000;">
                <h2 style="text-align:center; margin:0">CEDRO AVENTURAS</h2>
                <hr>
                <p><b>Crian√ßa:</b> ${nome}</p>
                <p><b>Respons√°vel:</b> ${resp}</p>
                <p><b>Tempo:</b> ${tempo} min ${bonusAtivo ? '(+20% B√¥nus)' : ''}</p>
                <p><b>Data:</b> ${agora}</p>
                <p><b>${op}</b></p>
                <hr>
                <p style="text-align:center; font-size:10px">Obrigado pela prefer√™ncia!</p>
            </div>
        `;
        window.print();
    };

    window.alertarFim = (veiculo) => {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.frequency.value = 440;
        osc.start();
        gain.gain.exponentialRampToValueAtTime(0.00001, ctx.currentTime + 1);
        osc.stop(ctx.currentTime + 1);

        const msg = new SpeechSynthesisUtterance();
        msg.text = `${veiculo} acabou!`;
        msg.lang = 'pt-BR';
        window.speechSynthesis.speak(msg);
    };

    if (Notification.permission !== 'granted') Notification.requestPermission();

    window.tentarLogin = () => {
        if (document.getElementById('pass').value === "1234") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'block';
            document.getElementById('op-nome').innerText = "Op: " + (document.getElementById('user').value || "Jeday");
        } else alert("Senha incorreta!");
    };

    window.toggleInstaPre = () => {
        bonusAtivo = !bonusAtivo;
        const btn = document.getElementById('bonus-toggle');
        btn.style.background = bonusAtivo ? "var(--insta)" : "#eee";
        btn.style.color = bonusAtivo ? "white" : "var(--insta)";
        btn.innerText = bonusAtivo ? "‚úÖ B√îNUS ATIVADO" : "üì∏ APLICAR B√îNUS INSTAGRAM (+20%)";
    };

    window.setQuickTime = (v) => document.getElementById('tempo-padrao').value = v;

    window.iniciar = async (veiculo) => {
        const minsOriginal = parseInt(document.getElementById('tempo-padrao').value) || 10;
        const ehLivre = minsOriginal >= 9999, agora = Date.now();
        let minsFinal = bonusAtivo && !ehLivre ? minsOriginal * 1.2 : minsOriginal;

        await addDoc(collection(db, "ativos"), {
            veiculo, crianca: document.getElementById('nome-crianca').value || "Cliente",
            timestamp: agora, fimTimestamp: agora + (minsFinal * 60 * 1000),
            pago: "N√£o", pausado: false, modalidadeLivre: ehLivre,
            msRestantes: (minsFinal * 60 * 1000), totalMsPausado: 0,
            tempoVendido: ehLivre ? "Livre" : minsOriginal, bonusInsta: bonusAtivo
        });
        document.getElementById('nome-crianca').value = "";
        if(bonusAtivo) window.toggleInstaPre();
    };

    window.finalizar = async (id) => {
        const snap = await getDoc(doc(db, "ativos", id));
        if (!snap.exists()) return;
        const d = snap.data(), agora = Date.now();
        let pausaExtra = d.pausado ? (agora - d.ultimoPause) : 0;
        const tempoRealMs = (agora - d.timestamp) - ((d.totalMsPausado || 0) + pausaExtra);
        const tempoRealMins = Math.max(1, Math.floor(tempoRealMs / 60000));
        
        await addDoc(collection(db, "historico"), {
            veiculo: d.veiculo, crianca: d.crianca, 
            inicio: new Date(d.timestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
            fim: new Date(agora).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}),
            tempoReal: tempoRealMins, valor: tempoRealMins, pago: d.pago, data: agora
        });
        await deleteDoc(doc(db, "ativos", id));
    };

    onSnapshot(collection(db, "ativos"), (snap) => {
        const container = document.getElementById('container-cards');
        const idsNoBanco = snap.docs.map(d => d.id);
        Object.keys(alertasAtivos).forEach(id => { if(!idsNoBanco.includes(id)) delete alertasAtivos[id]; });
        document.querySelectorAll('.card').forEach(c => { if(!idsNoBanco.includes(c.id.replace('card-',''))) c.remove(); });
        
        snap.docs.forEach(docSnap => {
            const d = docSnap.data(), id = docSnap.id;
            let card = document.getElementById(`card-${id}`);
            if (!card) {
                container.insertAdjacentHTML('beforeend', `
                    <div class="card" id="card-${id}">
                        ${d.bonusInsta ? '<div class="insta-badge-card">üì∏ INSTA (+20%)</div>' : ''}
                        <b style="font-size:14px">${d.veiculo}</b>
                        <div id="timer-${id}" style="font-size:38px; font-weight:bold; margin:5px 0;">00:00</div>
                        <div style="font-size:12px">Crian√ßa: <b>${d.crianca}</b></div>
                        <div style="font-size:11px" id="saida-${id}"></div>
                        <button class="btn-status-card" id="st-${id}" onclick="window.alternarPagamentoCard('${id}')"></button>
                        <div style="display:flex;">
                            <button class="btn-card" style="background:green" onclick="window.ajustar('${id}', 60)">+1m</button>
                            <button class="btn-card" style="background:orange" onclick="window.ajustar('${id}', -60)">-1m</button>
                            <button class="btn-card" style="background:blue" id="btn-p-${id}" onclick="window.togglePausa('${id}')">‚è∏</button>
                            <button class="btn-card" style="background:red" onclick="window.finalizar('${id}')">FIM</button>
                        </div>
                    </div>
                `);
                card = document.getElementById(`card-${id}`);
            }
            document.getElementById(`st-${id}`).innerText = d.pago === 'Sim' ? '‚úÖ PAGO' : '‚ùå PENDENTE';
            document.getElementById(`st-${id}`).className = `btn-status-card ${d.pago === 'Sim' ? 'status-pago' : 'status-pendente'}`;
            document.getElementById(`btn-p-${id}`).innerText = d.pausado ? '‚ñ∂' : '‚è∏';
            card.classList.toggle('paused', d.pausado);
            document.getElementById(`saida-${id}`).innerText = d.modalidadeLivre ? 'Sa√≠da: Livre' : `Sa√≠da: ${new Date(d.fimTimestamp).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`;

            if (window[`int-${id}`]) clearInterval(window[`int-${id}`]);
            window[`int-${id}`] = setInterval(() => {
                const tEl = document.getElementById(`timer-${id}`);
                if(!tEl) return;
                let s = d.pausado ? Math.max(0, Math.floor(d.msRestantes / 1000)) : (d.modalidadeLivre ? Math.floor((Date.now() - d.timestamp - (d.totalMsPausado || 0)) / 1000) : Math.max(0, Math.floor((d.fimTimestamp - Date.now()) / 1000)));
                
                if (d.modalidadeLivre) card.style.order = "999999";
                else card.style.order = s;

                tEl.innerText = `${Math.floor(s/60)}:${(s%60).toString().padStart(2,'0')}`;
                
                if (!d.modalidadeLivre && s <= 0) {
                    card.classList.add('expired');
                    if(!alertasAtivos[id]) {
                        alertasAtivos[id] = true;
                        window.alertarFim(d.veiculo);
                        const n = new Notification("‚è∞ TEMPO ESGOTADO!", { body: `${d.veiculo} (${d.crianca}) acabou!` });
                        n.onclick = () => { window.focus(); };
                    }
                } else { card.classList.remove('expired'); }
            }, 1000);
        });
    });

    window.togglePausa = async (id) => {
        const r = doc(db, "ativos", id), s = await getDoc(r);
        const d = s.data(), agora = Date.now();
        if (!d.pausado) await updateDoc(r, { pausado: true, msRestantes: d.fimTimestamp - agora, ultimoPause: agora });
        else await updateDoc(r, { pausado: false, fimTimestamp: agora + d.msRestantes, totalMsPausado: (d.totalMsPausado || 0) + (agora - d.ultimoPause) });
    };

    window.ajustar = async (id, seg) => {
        const r = doc(db, "ativos", id), s = await getDoc(r), d = s.data();
        if (d.pausado) await updateDoc(r, { msRestantes: d.msRestantes + (seg * 1000) });
        else await updateDoc(r, { fimTimestamp: d.fimTimestamp + (seg * 1000) });
    };

    window.renderizarTabelas = () => {
        const filtroB = document.getElementById('filtro-brinquedo').value;
        const filtroD = document.getElementById('filtro-data').value; // Formato YYYY-MM-DD
        
        // 1. Resumo por Brinquedo (Baseado em todos os dados carregados ou filtro se preferir)
        const tbAg = document.querySelector("#tabela-agrupada tbody");
        tbAg.innerHTML = "";
        const resumo = {};
        dadosHistorico.forEach(h => {
            if (!resumo[h.veiculo]) resumo[h.veiculo] = { min: 0, val: 0 };
            resumo[h.veiculo].min += h.tempoReal; resumo[h.veiculo].val += h.valor;
        });
        for (let v in resumo) tbAg.innerHTML += `<tr><td>${v}</td><td>${resumo[v].min}m</td><td>R$ ${resumo[v].val.toFixed(2)}</td></tr>`;

        // 2. Tabela Detalhada com Agrupamento por Dia
        const tbDet = document.querySelector("#tabela-detalhada tbody");
        tbDet.innerHTML = "";
        let somaDet = 0;
        let diaAtual = "";

        dadosHistorico.forEach(h => {
            const dataObj = new Date(h.data);
            const dataString = dataObj.toLocaleDateString('pt-BR');
            const dataISO = dataObj.toISOString().split('T')[0];

            // Filtros
            const passaFiltroBrinquedo = (filtroB === "Todos" || h.veiculo === filtroB);
            const passaFiltroData = (!filtroD || dataISO === filtroD);

            if (passaFiltroBrinquedo && passaFiltroData) {
                // Cabe√ßalho do Dia (se mudou o dia e n√£o estamos filtrando por um √∫nico dia fixo no input)
                if (dataString !== diaAtual) {
                    tbDet.innerHTML += `<tr><td colspan="6" class="header-dia">üìÖ Dia ${dataString}</td></tr>`;
                    diaAtual = dataString;
                }

                somaDet += h.valor;
                tbDet.innerHTML += `<tr>
                    <td>${h.veiculo}</td><td>${h.crianca}</td><td>${h.inicio}-${h.fim}</td><td>${h.tempoReal}m</td>
                    <td>R$ ${h.valor.toFixed(2)}</td>
                    <td><button class="badge ${h.pago==='Sim'?'pago':'pendente'}" onclick="window.alternarPagamentoHist('${h.id}')">${h.pago==='Sim'?'PAGO':'PENDENTE'}</button></td>
                </tr>`;
            }
        });
        document.getElementById('valor-total-detalhado').innerText = `R$ ${somaDet.toFixed(2)}`;
    };

    onSnapshot(query(collection(db, "historico"), orderBy("data", "desc")), (snap) => {
        dadosHistorico = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        window.renderizarTabelas();
    });

    window.alternarPagamentoCard = async (id) => {
        const r = doc(db, "ativos", id), s = await getDoc(r);
        if(s.exists()) await updateDoc(r, { pago: s.data().pago === 'Sim' ? 'N√£o' : 'Sim' });
    };

    window.alternarPagamentoHist = async (id) => {
        const r = doc(db, "historico", id), s = await getDoc(r);
        await updateDoc(r, { pago: s.data().pago === 'Sim' ? 'N√£o' : 'Sim' });
    };

    window.exportarZap = () => {
        let texto = `üå≤ *CEDRO AVENTURAS - RESUMO*\n--------------------------------\n`;
        const resumo = {}; let total = 0;
        dadosHistorico.forEach(h => {
            if (!resumo[h.veiculo]) resumo[h.veiculo] = { min: 0, val: 0 };
            resumo[h.veiculo].min += h.tempoReal; resumo[h.veiculo].val += h.valor; total += h.valor;
        });
        for (let v in resumo) texto += `üöó *${v}*\n‚è± ${resumo[v].min} min | R$ ${resumo[v].val.toFixed(2)}\n\n`;
        texto += `--------------------------------\n*TOTAL: R$ ${total.toFixed(2)}*`;
        window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(texto)}`);
    };

    window.limparCardsGeral = async () => { if(confirm("Limpar ativos?")) { const s = await getDocs(collection(db, "ativos")), b = writeBatch(db); s.forEach(d => b.delete(d.ref)); await b.commit(); } };
    window.limparRelatorio = async () => { if(confirm("Limpar hist√≥rico?")) { const s = await getDocs(collection(db, "historico")), b = writeBatch(db); s.forEach(d => b.delete(d.ref)); await b.commit(); } };
    setInterval(() => { document.getElementById('relogio').innerText = new Date().toLocaleTimeString(); }, 1000);
</script>
</body>
</html>